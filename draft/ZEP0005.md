---
layout: default
title: ZEP0005
description: This ZEP proposes a Zarr extension for an algorithm developed at NASA’s GES DISC for fast and cost-efficient multi-dimensional averaging service -- Zarr-based Chunk-level Accumulation in Reduced Dimensions.
parent: draft ZEPs
nav_order: 5
---

# ZEP 5 — Zarr-based Chunk-level Accumulation in Reduced Dimensions

Authors:
* Hailiang Zhang ([@hailiangzhang](https://github.com/hailiangzhang)), Adnet Systems Inc, NASA Goddard Space Flight Center.

Status: Draft

Type: Specification

Created: 2023-02-12

## Abstract

At NASA GES DISC, we receive a large number of user requests each day for a variety of analysis and visualization services involving averaging along one or more dimensions, some of which are computationally expensive when running against large amounts of geospatial data. We proposed a generic and dimension-agnostic method based on chunk-level cumulative sums (accumulation) on a regular grid, which provides fast and cost-efficient cloud analysis for multidimensional averaging services. This method introduces a small adjustable set of auxiliary data on top of the raw data, but dramatically reduces the computational time by orders of magnitude based on chunk-level weighted cumulative sums along one or more dimensions.
We hereby propose a Zarr extension for this chunk-level accumulation approach. In this proposal, we will present a Zarr group for the accumulation data, a JSON schema for the accumulation group attribute, a JSON schema for the accumulation data array attribute, and an example of the user application interface.

## Motivation and Scope

Performing the averaging operation over data in Zarr generally requires a full scan of the data. This can be parallelized with Dask (or any other distributed framework), but reading all of the data is an unavoidable bottleneck. Our proposed approach, Zarr-based Chunk-level Accumulation, will improve the speed and cost of long-range calculation by loading only a few data chunks at the averaging boundary. Here, we provide examples of how the approach is applied to geospatial data with temporal and spatial dimensions; however, it’s noteworthy that this approach is dimension-agnostic and can be generalized for all types of multidimensional data aggregation services with Zarr.

## Usage and Impact

## Backward Compatibility

## Detailed description

The fundamental of this Zarr-based Chunk-level Accumulation algorithm is to pre-compute cumulative sums of data values and weights/counts along data dimensions at the chunk intervals. These cumulative sums can then be used to find data averages for dimension ranges. 
Example:
For a sequence A=(a, b, c, d), the cumulative sums are S=(s0, s1, s2, s3) where s0=a, s1=a+b, s2=a+b+c, s3=a+b+c+d. The average of the sequence over a range can now be calculated using the cumulative sums, i.e.  (S[n]-S[m])/(n-m) where [m,n] is the averaging range. For example, assuming zero-based indexing, average(A[1:3])=(S[3]-S[0])/3=(s3-s0)/3.
The above example can be extended and generalized for multiple dimensions. This makes the problem of computing averages O(1) vs O(N^m) for the dimensions being averaged, where N is the number of data values and  m is the number of dimensions.  See our [ESIP 2022 presentation](https://www.youtube.com/watch?v=ac_UKunUrNM&t=2250s) (and [the slides](https://docs.google.com/presentation/d/1RNvkIlCFvtoy89OTMzQNn_0jixOpdhnu/edit?usp=sharing&ouid=106287227661991623566&rtpof=true&sd=true)) for a more detailed description. 

## Implementation

## Discussion


## References and Footnotes



## Copyright

This proposal is licensed under the Apache License, Version 2.0.
